<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng Qu·∫£n l√Ω Salon T√≥c</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #49958e, #3a7a75);
            color: white;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-header .logo-icon {
            font-size: 24px;
        }

        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 600;
            color: white;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 15px;
            font-weight: 400;
            position: relative;
        }
        
        .nav-item:focus {
            outline: none;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
        }

        .nav-item.active {
            border-right: 3px solid white;
        }

        .nav-item .nav-icon {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-item .nav-icon svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 0;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .header {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h2 {
            color: #49958e;
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header h2 .page-icon {
            font-size: 24px;
        }

        .header h2 .page-icon svg {
            width: 24px;
            height: 24px;
            stroke: #49958e;
            fill: none;
            stroke-width: 2;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            display: none;
            background: #49958e;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            min-width: 44px;
            min-height: 44px;
            align-items: center;
            justify-content: center;
        }

        .menu-toggle:hover {
            background: #3a7a75;
        }

        .current-time {
            color: #666;
            font-size: 16px;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #49958e;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
            font-size: 16px;
        }

        /* Chart Container */
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            color: #49958e;
            font-size: 20px;
        }

        .date-picker {
            padding: 8px 12px;
            border: 2px solid #49958e;
            border-radius: 6px;
            font-size: 14px;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            color: #49958e;
            font-size: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #49958e;
            color: white;
        }

        .btn-primary:hover {
            background: #3a7a75;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #49958e;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-online {
            background: #dcfce7;
            color: #16a34a;
        }

        .status-offline {
            background: #fef3c7;
            color: #d97706;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* Custom Confirm Dialog */
        .custom-confirm {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .custom-confirm.show {
            display: flex !important;
        }

        .confirm-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .confirm-message {
            font-size: 16px;
            margin-bottom: 25px;
            color: #333;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-buttons .btn {
            min-width: 100px;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #16a34a;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            z-index: 3000;
            animation: slideInRight 0.3s ease;
        }

        .toast.error {
            background: #dc2626;
        }

        /* Animations */
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                max-width: 280px;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .menu-toggle {
                display: flex;
            }

            .header {
                padding: 15px 20px;
            }

            .header h2 {
                font-size: 20px;
            }

            .content {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .table-container {
                overflow-x: auto;
            }

            table {
                min-width: 600px;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Modal Styling */
        .custom-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.25);
            z-index: 4000;
            align-items: center;
            justify-content: center;
            animation: fadeInModal 0.2s;
        }
        .custom-modal.show {
            display: flex !important;
        }
        .modal-content {
            background: #fff;
            border-radius: 18px;
            padding: 32px 24px 20px 24px;
            min-width: 320px;
            max-width: 95vw;
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
            position: relative;
            animation: modalPop 0.25s;
        }
        .modal-content h3 {
            text-align: center;
            color: #49958e;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 18px;
        }
        .modal-content input,
        .modal-content textarea {
            width: 100%;
            padding: 11px 12px;
            border: 1.5px solid #c3cfe2;
            border-radius: 8px;
            font-size: 15px;
            margin-bottom: 13px;
            transition: border 0.2s;
            background: #f8f9fa;
            resize: none;
        }
        .modal-content input:focus,
        .modal-content textarea:focus {
            border: 1.5px solid #49958e;
            outline: none;
            background: #fff;
        }
        .modal-content .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 8px;
        }
        @media (max-width: 480px) {
            .modal-content {
                padding: 18px 7px 12px 7px;
                min-width: unset;
            }
            .modal-content h3 {
                font-size: 18px;
            }
        }
        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes modalPop {
            from { transform: scale(0.95); opacity: 0.7; }
            to { transform: scale(1); opacity: 1; }
        }
        .service-badge {
            display: inline-block;
            background: #f5f7fa;
            color: #49958e;
            border-radius: 999px;
            border: 1.2px solid #c3cfe2;
            padding: 2px 12px 2px 12px;
            font-size: 13px;
            font-weight: 600;
            margin: 0 4px 4px 0;
            line-height: 1.7;
            box-shadow: none;
            letter-spacing: 0.01em;
        }
        .role-radio-group {
            display: flex;
            justify-content: center;
            gap: 18px;
            background: #f8f9fa;
            border-radius: 18px;
            padding: 10px 0 6px 0;
            margin: 12px 0 18px 0;
        }
        .role-radio-group label {
            font-weight: 500;
            color: #49958e;
            padding: 4px 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .role-radio-group input[type=radio] {
            accent-color: #49958e;
            margin-right: 4px;
        }
    </style>
</head>
<body>
    <div id="loginOverlay" style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.15); align-items:center; justify-content:center;">
        <form id="loginForm" style="background:#fff; padding:32px 28px; border-radius:14px; box-shadow:0 8px 32px rgba(0,0,0,0.18); min-width:320px; max-width:95vw; display:flex; flex-direction:column; gap:18px;">
          <h2 style="color:#49958e; text-align:center;">ƒêƒÉng nh·∫≠p Admin</h2>
          <input id="adminUser" type="text" placeholder="T√†i kho·∫£n" required autofocus>
          <input id="adminPass" type="password" placeholder="M·∫≠t kh·∫©u" required>
          <button type="submit" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>
          <div id="loginError" style="color:#dc2626; text-align:center; display:none;">Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!</div>
        </form>
      </div>
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon">‚úÇÔ∏è</div>
                <h1>Salon Manager</h1>
            </div>
            <div class="nav-menu">
                <button class="nav-item active" data-section="overview">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9,22 9,12 15,12 15,22"></polyline>
                        </svg>
                    </div>
                    T·ªïng quan
                </button>
                <button class="nav-item" data-section="notifications">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="m13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                    </div>
                    Qu·∫£n l√Ω booking
                </button>
                <button class="nav-item" data-section="staff">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    Nh√¢n vi√™n
                </button>
                <button class="nav-item" data-section="services">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                        </svg>
                    </div>
                    D·ªãch v·ª•
                </button>
                <button class="nav-item" data-section="customers">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="m22 21-3-3"></path>
                            <path d="m22 18-3 3"></path>
                        </svg>
                    </div>
                    Kh√°ch h√†ng
                </button>
                <button class="nav-item" data-section="revenue">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </div>
                    Doanh thu
                </button>
                <button class="nav-item" data-section="expenses">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 20h9"></path>
                            <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"></path>
                        </svg>
                    </div>
                    Thu chi
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">‚ò∞</button>
                    <h2 id="pageTitle">
                        <div class="page-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9,22 9,12 15,12 15,22"></polyline>
                            </svg>
                        </div>
                        T·ªïng quan
                    </h2>
                </div>
                <div class="header-right">
                    <div class="current-time" id="currentTime"></div>
                    <button onclick="logoutAdmin()" class="btn btn-danger" style="margin-left:10px;">ƒêƒÉng xu·∫•t</button>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Overview Section -->
                <section class="section active" id="overview">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3 id="todayRevenue">0</h3>
                            <p>Doanh thu h√¥m nay</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="todayAppointments">0</h3>
                            <p>L·ªãch h·∫πn h√¥m nay</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="newCustomers">0</h3>
                            <p>Kh√°ch h√†ng m·ªõi</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="onlineStaff">0</h3>
                            <p>Nh√¢n vi√™n online</p>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Bi·ªÉu ƒë·ªì doanh thu th√°ng</h3>
                            <input type="month" class="date-picker" id="chartMonth" />
                        </div>
                        <canvas id="revenueChart" height="100"></canvas>
                    </div>
                </section>

                <!-- Notifications Section -->
                <section class="section" id="notifications">
                    <!-- Danh s√°ch Booking -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>üìÖ Danh s√°ch Booking</h3>
                            <div style="color: #666; font-size: 14px;">D·ªØ li·ªáu t·ª± ƒë·ªông t·ª´ trang booking</div>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="bookingsTable">
                                <thead>
                                    <tr>
                                        <th>Kh√°ch h√†ng</th>
                                        <th>S·ªë ƒëi·ªán tho·∫°i</th>
                                        <th>D·ªãch v·ª•</th>
                                        <th>Nh√¢n vi√™n</th>
                                        <th>Ng√†y</th>
                                        <th>Gi·ªù</th>
                                        <th>Tr·∫°ng th√°i</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Qu·∫£n l√Ω Th√¥ng b√°o -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>üîî Qu·∫£n l√Ω Th√¥ng b√°o</h3>
                            <button class="btn btn-primary" onclick="openModal('notificationModal')">
                                + Th√™m th√¥ng b√°o
                            </button>
                            <div style="color: #666; font-size: 14px; margin-top: 5px;">Th√¥ng b√°o hi·ªÉn th·ªã tr√™n trang booking</div>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="notificationsTable">
                                <thead>
                                    <tr>
                                        <th>Ng√†y t·∫°o</th>
                                        <th>Ti√™u ƒë·ªÅ</th>
                                        <th>N·ªôi dung</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Staff Section -->
                <section class="section" id="staff">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Qu·∫£n l√Ω Nh√¢n vi√™n</h3>
                            <button class="btn btn-primary" onclick="openModal('staffModal')">
                                + Th√™m nh√¢n vi√™n
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="staffTable">
                                <thead>
                                    <tr>
                                        <th>T√™n</th>
                                        <th>Ch·ª©c v·ª•</th>
                                        <th>S·ªë ƒëi·ªán tho·∫°i</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Services Section -->
                <section class="section" id="services">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Qu·∫£n l√Ω D·ªãch v·ª•</h3>
                            <button class="btn btn-primary" onclick="openModal('serviceModal')">
                                + Th√™m d·ªãch v·ª•
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="servicesTable">
                                <thead>
                                    <tr>
                                        <th>T√™n d·ªãch v·ª•</th>
                                        <th>Gi√° (VNƒê)</th>
                                        <th>Th·ªùi gian (ph√∫t)</th>
                                        <th>M√¥ t·∫£</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Customers Section -->
                <section class="section" id="customers">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Qu·∫£n l√Ω Kh√°ch h√†ng</h3>
                            <button class="btn btn-primary" onclick="openModal('customerModal')">
                                + Th√™m kh√°ch h√†ng
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="customersTable">
                                <thead>
                                    <tr>
                                        <th>T√™n kh√°ch h√†ng</th>
                                        <th>S·ªë ƒëi·ªán tho·∫°i</th>
                                        <th>L·∫ßn c·∫Øt cu·ªëi</th>
                                        <th>Lo·∫°i ƒë·∫ßu</th>
                                        <th>Ghi ch√∫</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Revenue Section -->
                <section class="section" id="revenue">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>B√°o c√°o Doanh thu</h3>
                            <button class="btn btn-primary" onclick="openModal('revenueModal')">
                                + Th√™m giao d·ªãch
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="revenueTable">
                                <thead>
                                    <tr>
                                        <th>Th·ªùi gian</th>
                                        <th>Nh√¢n vi√™n</th>
                                        <th>D·ªãch v·ª•</th>
                                        <th>Kh√°ch h√†ng</th>
                                        <th>S·ªë ti·ªÅn (VNƒê)</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Expenses Section -->
                <section class="section" id="expenses">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Qu·∫£n l√Ω Thu chi</h3>
                            <button class="btn btn-primary" onclick="openModal('expenseModal')">
                                + Th√™m chi ph√≠
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="expensesTable">
                                <thead>
                                    <tr>
                                        <th>Ng√†y</th>
                                        <th>Lo·∫°i chi ph√≠</th>
                                        <th>M√¥ t·∫£</th>
                                        <th>S·ªë ti·ªÅn (VNƒê)</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Custom Confirm Dialog -->
    <div class="custom-confirm" id="customConfirm">
        <div class="confirm-content">
            <div class="confirm-message" id="confirmMessage">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√¥ng?</div>
            <div class="confirm-buttons">
                <button class="btn btn-secondary" onclick="closeConfirm(false)" type="button">H·ªßy</button>
                <button class="btn btn-danger" onclick="closeConfirm(true)" type="button">X√≥a</button>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="custom-modal" id="notificationModal">
        <div class="modal-content">
            <h3 id="notificationModalTitle">Th√™m th√¥ng b√°o</h3>
            <input id="notificationTitle" type="text" placeholder="Ti√™u ƒë·ªÅ" />
            <textarea id="notificationContent" placeholder="M√¥ t·∫£" rows="3"></textarea>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('notificationModal')" type="button">H·ªßy</button>
                <button class="btn btn-primary" id="saveNotificationBtn" type="button">L∆∞u</button>
            </div>
        </div>
    </div>

    <!-- Staff Modal -->
    <div class="custom-modal" id="staffModal">
        <div class="modal-content">
            <h3 id="staffModalTitle">Th√™m nh√¢n vi√™n</h3>
            <input id="staffName" type="text" placeholder="T√™n nh√¢n vi√™n" />
            <input id="staffPhone" type="text" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
            <div id="staffPositionGroup" class="role-radio-group">
              <label><input type="radio" name="staffPosition" value="Qu·∫£n l√Ω"> Qu·∫£n l√Ω</label>
              <label><input type="radio" name="staffPosition" value="Thu ng√¢n"> Thu ng√¢n</label>
              <label><input type="radio" name="staffPosition" value="Barber"> Barber</label>
              <label><input type="radio" name="staffPosition" value="Skinner"> Skinner</label>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('staffModal')" type="button">H·ªßy</button>
                <button class="btn btn-primary" id="saveStaffBtn" type="button">L∆∞u</button>
            </div>
        </div>
    </div>

    <!-- Service Modal -->
    <div class="custom-modal" id="serviceModal">
        <div class="modal-content">
            <h3 id="serviceModalTitle">Th√™m d·ªãch v·ª•</h3>
            <input id="serviceName" type="text" placeholder="T√™n d·ªãch v·ª•" />
            <input id="servicePrice" type="number" placeholder="Gi√° (VNƒê)" />
            <input id="serviceDuration" type="number" placeholder="Th·ªùi gian (ph√∫t)" />
            <textarea id="serviceDescription" placeholder="M√¥ t·∫£" rows="3"></textarea>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('serviceModal')" type="button">H·ªßy</button>
                <button class="btn btn-primary" id="saveServiceBtn" type="button">L∆∞u</button>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let salonData = {
            bookings: [
                { id: 1, customerName: "Nguy·ªÖn VƒÉn A", phone: "0901234567", service: "C·∫Øt t√≥c nam", staff: "Nguy·ªÖn VƒÉn An", date: "2025-05-27", time: "09:00", status: "ƒê√£ x√°c nh·∫≠n" },
                { id: 2, customerName: "Tr·∫ßn Th·ªã B", phone: "0907654321", service: "C·∫Øt t√≥c n·ªØ", staff: "Tr·∫ßn Th·ªã B√¨nh", date: "2025-05-27", time: "10:30", status: "Ch·ªù x√°c nh·∫≠n" },
                { id: 3, customerName: "L√™ VƒÉn C", phone: "0912345678", service: "Nhu·ªôm t√≥c", staff: "Nguy·ªÖn VƒÉn An", date: "2025-05-28", time: "14:00", status: "ƒê√£ x√°c nh·∫≠n" }
            ],
            notifications: [
                { id: 1, title: "Khuy·∫øn m√£i th√°ng 5", content: "Gi·∫£m gi√° 20% cho kh√°ch h√†ng m·ªõi", date: "2025-05-01" },
                { id: 2, title: "Th√¥ng b√°o ngh·ªâ l·ªÖ", content: "Salon ngh·ªâ ng√†y 30/4 v√† 1/5", date: "2025-04-28" }
            ],
            staff: [
                { id: 1, name: "Nguy·ªÖn VƒÉn An", position: "Th·ª£ c·∫Øt t√≥c", phone: "0901234567" },
                { id: 2, name: "Tr·∫ßn Th·ªã B√¨nh", position: "Th·ª£ g·ªôi ƒë·∫ßu", phone: "0907654321" },
                { id: 3, name: "L√™ VƒÉn C∆∞·ªùng", position: "Qu·∫£n l√Ω", phone: "0912345678" }
            ],
            services: [
                { id: 1, name: "C·∫Øt t√≥c nam", price: 80000, duration: 30, description: "C·∫Øt t√≥c nam c∆° b·∫£n" },
                { id: 2, name: "C·∫Øt t√≥c n·ªØ", price: 120000, duration: 45, description: "C·∫Øt t√≥c n·ªØ c∆° b·∫£n" },
                { id: 3, name: "G·ªôi ƒë·∫ßu massage", price: 50000, duration: 20, description: "G·ªôi ƒë·∫ßu v√† massage th∆∞ gi√£n" },
                { id: 4, name: "Nhu·ªôm t√≥c", price: 300000, duration: 90, description: "Nhu·ªôm t√≥c c√°c m√†u" }
            ],
            customers: [
                { id: 1, name: "Ph·∫°m VƒÉn ƒê·ª©c", phone: "0908888888", lastCut: "2025-05-27", hairType: "T√≥c th·∫≥ng", notes: "Th√≠ch c·∫Øt ng·∫Øn" },
                { id: 2, name: "Nguy·ªÖn Th·ªã Em", phone: "0909999999", lastCut: "2025-05-27", hairType: "T√≥c xoƒÉn", notes: "C·∫ßn t∆∞ v·∫•n ki·ªÉu t√≥c" },
                { id: 3, name: "L√™ Th√†nh Ph√∫", phone: "0907777777", lastCut: "2025-05-26", hairType: "T√≥c th·∫≥ng", notes: "Kh√°ch h√†ng VIP" }
            ],
            revenue: [
                { id: 1, date: "2025-05-27T09:00", staff: "Nguy·ªÖn VƒÉn An", service: "C·∫Øt t√≥c nam", customer: "Ph·∫°m VƒÉn ƒê·ª©c", amount: 80000 },
                { id: 2, date: "2025-05-27T10:30", staff: "Tr·∫ßn Th·ªã B√¨nh", service: "G·ªôi ƒë·∫ßu massage", customer: "Nguy·ªÖn Th·ªã Em", amount: 50000 },
                { id: 3, date: "2025-05-27T14:15", staff: "Nguy·ªÖn VƒÉn An", service: "C·∫Øt t√≥c n·ªØ", customer: "L√™ Th√†nh Ph√∫", amount: 120000 },
                { id: 4, date: "2025-05-26T16:00", staff: "Tr·∫ßn Th·ªã B√¨nh", service: "Nhu·ªôm t√≥c", customer: "Nguy·ªÖn Th·ªã Em", amount: 300000 }
            ],
            expenses: [
                { id: 1, date: "2025-05-27", type: "V·∫≠t t∆∞", description: "Mua k√©o c·∫Øt t√≥c m·ªõi", amount: 500000 },
                { id: 2, date: "2025-05-26", type: "ƒêi·ªán n∆∞·ªõc", description: "Ti·ªÅn ƒëi·ªán th√°ng 5", amount: 800000 },
                { id: 3, date: "2025-05-25", type: "L∆∞∆°ng nh√¢n vi√™n", description: "L∆∞∆°ng th√°ng 5", amount: 15000000 }
            ]
        };

        let currentEditId = null;
        let revenueChart = null;
        let confirmCallback = null;
        let editingNotificationId = null;
        let editingStaffId = null;
        let editingServiceId = null;
        let editingExpenseId = null;

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { 
                style: 'currency', 
                currency: 'VND' 
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('vi-VN');
        }

        function formatDateTime(dateTimeString) {
            return new Date(dateTimeString).toLocaleString('vi-VN');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function generateId(array) {
            return array.length > 0 ? Math.max(...array.map(item => item.id)) + 1 : 1;
        }

        // Custom Confirm Dialog Functions
        function showCustomConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('customConfirm').classList.add('show');
            confirmCallback = callback;
            document.body.style.overflow = 'hidden';
        }

        function closeConfirm(confirmed) {
            document.getElementById('customConfirm').classList.remove('show');
            document.body.style.overflow = '';
            
            if (confirmCallback) {
                if (confirmed) {
                    confirmCallback();
                }
                confirmCallback = null;
            }
        }

        // Delete Function
        function deleteItem(type, id) {
            const confirmMessage = `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ${type === 'bookings' ? 'booking' : 
                                    type === 'notifications' ? 'th√¥ng b√°o' : 
                                    type === 'staff' ? 'nh√¢n vi√™n' : 
                                    type === 'services' ? 'd·ªãch v·ª•' : 
                                    type === 'customers' ? 'kh√°ch h√†ng' : 
                                    type === 'revenue' ? 'giao d·ªãch' : 'chi ph√≠'} n√†y kh√¥ng?`;
            showCustomConfirm(confirmMessage, () => {
                try {
                    if(type === 'revenue') {
                        // X√≥a trong localStorage
                        let revenue = localStorage.getItem('salon_revenue');
                        if (revenue) {
                            try { revenue = JSON.parse(revenue); } catch { revenue = []; }
                        } else { revenue = []; }
                        const index = revenue.findIndex(item => item.id == id);
                        if (index > -1) {
                            revenue.splice(index, 1);
                            localStorage.setItem('salon_revenue', JSON.stringify(revenue));
                            showToast('X√≥a th√†nh c√¥ng!');
                            setTimeout(() => { renderRevenue(); updateStats(); updateChart(); }, 100);
                        } else {
                            showToast('Kh√¥ng t√¨m th·∫•y m·ª•c c·∫ßn x√≥a!', 'error');
                        }
                        return;
                    }
                    // X√≥a c√°c lo·∫°i kh√°c nh∆∞ c≈©
                    const index = salonData[type].findIndex(item => item.id == id);
                    if (index > -1) {
                        salonData[type].splice(index, 1);
                        // N·∫øu l√† d·ªãch v·ª• th√¨ ƒë·ªìng b·ªô l·∫°i localStorage
                        if(type === 'services') {
                            localStorage.setItem('salon_services', JSON.stringify(salonData.services));
                        }
                        // N·∫øu l√† nh√¢n vi√™n th√¨ ƒë·ªìng b·ªô l·∫°i localStorage
                        if(type === 'staff') {
                            localStorage.setItem('salon_staff', JSON.stringify(salonData.staff));
                        }
                        showToast('X√≥a th√†nh c√¥ng!');
                        setTimeout(() => {
                            switch(type) {
                                case 'bookings':
                                    renderBookings();
                                    updateStats();
                                    break;
                                case 'notifications':
                                    renderNotifications();
                                    break;
                                case 'staff':
                                    renderStaff();
                                    updateStats();
                                    break;
                                case 'services':
                                    renderServices();
                                    break;
                                case 'customers':
                                    renderCustomers();
                                    updateStats();
                                    break;
                                case 'revenue':
                                    renderRevenue();
                                    updateStats();
                                    updateChart();
                                    break;
                                case 'expenses':
                                    renderExpenses();
                                    updateChart();
                                    break;
                            }
                        }, 100);
                    } else {
                        showToast('Kh√¥ng t√¨m th·∫•y m·ª•c c·∫ßn x√≥a!', 'error');
                    }
                    // Trong h√†m deleteItem, n·∫øu type === 'customers' th√¨ sau khi x√≥a c≈©ng ƒë·ªìng b·ªô localStorage
                    if(type === 'customers') {
                        localStorage.setItem('salon_customers', JSON.stringify(salonData.customers));
                    }
                } catch (error) {
                    showToast('C√≥ l·ªói x·∫£y ra khi x√≥a!', 'error');
                }
            });
        }

        function renderBookings() {
            const tbody = document.querySelector('#bookingsTable tbody');
            if (!tbody) return;
            let bookings = getData('salon_bookings', []);
            tbody.innerHTML = '';
            if (bookings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="no-data">Ch∆∞a c√≥ booking n√†o t·ª´ trang booking</td></tr>';
                return;
            }
            bookings.forEach(item => {
                if (!item.id) item.id = Date.now() + Math.floor(Math.random()*100000);
                if (!item.status) item.status = 'Ch·ªù x√°c nh·∫≠n';
                const statusClass = item.status === 'ƒê√£ x√°c nh·∫≠n' ? 'status-online' : 'status-offline';
                tbody.innerHTML += `
                    <tr>
                        <td>${item.customerName || item.name || ''}</td>
                        <td>${item.phone || ''}</td>
                        <td>${item.service}</td>
                        <td>${item.staff}</td>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.time}</td>
                        <td><span class="status-badge ${statusClass}">${item.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="confirmBooking(${item.id})" type="button">
                                ${(item.status === 'ƒê√£ x√°c nh·∫≠n') ? 'H·ªßy' : 'X√°c nh·∫≠n'}
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('bookings', ${item.id})" type="button">X√≥a</button>
                        </td>
                    </tr>
                `;
            });
            setData('salon_bookings', bookings);
        }

        function confirmBooking(id) {
            let bookings = getData('salon_bookings', []);
            const booking = bookings.find(item => item.id == id);
            if (booking) {
                booking.status = booking.status === 'ƒê√£ x√°c nh·∫≠n' ? 'Ch·ªù x√°c nh·∫≠n' : 'ƒê√£ x√°c nh·∫≠n';
                setData('salon_bookings', bookings);
                renderBookings();
                updateStats();
                showToast(`Booking ƒë√£ ${booking.status.toLowerCase()}!`);
            }
        }

        // Navigation
        function initNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.section');
            const pageTitle = document.getElementById('pageTitle');

            const sectionIcons = {
                'overview': '<svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9,22 9,12 15,12 15,22"></polyline></svg>',
                'notifications': '<svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="m13.73 21a2 2 0 0 1-3.46 0"></path></svg>',
                'staff': '<svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
                'services': '<svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>',
                'customers': '<svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="m22 21-3-3"></path><path d="m22 18-3 3"></path></svg>',
                'revenue': '<svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>',
                'expenses': '<svg viewBox="0 0 24 24"><path d="M12 20h9"></path><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"></path></svg>'
            };

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    sections.forEach(section => section.classList.remove('active'));
                    
                    const sectionId = item.dataset.section;
                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }
                    
                    const titleText = item.textContent.trim();
                    const iconSvg = sectionIcons[sectionId] || '';
                    pageTitle.innerHTML = `
                        <div class="page-icon">${iconSvg}</div>
                        ${titleText}
                    `;
                    
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.remove('show');
                    }
                });
            });
        }

        // Mobile Menu
        function initMobileMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            
            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                sidebar.classList.toggle('show');
            });
            
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768) {
                    if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                        sidebar.classList.remove('show');
                    }
                }
            });

            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('show');
                    }
                });
            });

            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    sidebar.classList.remove('show');
                }
            });
        }

        // Render Functions
        function renderNotifications() {
            const tbody = document.querySelector('#notificationsTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (salonData.notifications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="no-data">Ch∆∞a c√≥ th√¥ng b√°o n√†o</td></tr>';
                return;
            }
            
            salonData.notifications.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.title}</td>
                        <td>${item.content}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="openModal('notificationModal', ${item.id})" type="button">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('notifications', ${item.id})" type="button">X√≥a</button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderStaff() {
            const tbody = document.querySelector('#staffTable tbody');
            if (!tbody) return;
            const staff = getData('salon_staff', []);
            tbody.innerHTML = '';
            if (staff.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="no-data">Ch∆∞a c√≥ nh√¢n vi√™n n√†o</td></tr>';
                return;
            }
            staff.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.position}</td>
                        <td>${item.phone}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="openModal('staffModal', ${item.id})" type="button">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('staff', ${item.id})" type="button">X√≥a</button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderServices() {
            const tbody = document.querySelector('#servicesTable tbody');
            if (!tbody) return;
            const services = getData('salon_services', []);
            tbody.innerHTML = '';
            if (services.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">Ch∆∞a c√≥ d·ªãch v·ª• n√†o</td></tr>';
                return;
            }
            services.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${formatCurrency(item.price)}</td>
                        <td>${item.duration}</td>
                        <td>${item.description || ''}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="openModal('serviceModal', ${item.id})" type="button">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('services', ${item.id})" type="button">X√≥a</button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderCustomers() {
            const tbody = document.querySelector('#customersTable tbody');
            if (!tbody) return;
            const customers = getData('salon_customers', []);
            tbody.innerHTML = '';
            if (customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">Ch∆∞a c√≥ kh√°ch h√†ng n√†o</td></tr>';
                return;
            }
            customers.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.phone}</td>
                        <td>${item.lastCut ? formatDate(item.lastCut) : ''}</td>
                        <td>${item.hairType || ''}</td>
                        <td>${item.notes || ''}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="alert('Ch·ª©c nƒÉng s·ª≠a ƒëang ph√°t tri·ªÉn')" type="button">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('customers', ${item.id})" type="button">X√≥a</button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderRevenue() {
            const tbody = document.querySelector('#revenueTable tbody');
            if (!tbody) return;
            let revenue = getData('salon_revenue', []);
            tbody.innerHTML = '';
            if (revenue.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">Ch∆∞a c√≥ giao d·ªãch n√†o</td></tr>';
                return;
            }
            const groupKey = item => `${item.date}|${item.staff}|${item.customer || ''}`;
            const grouped = {};
            revenue.forEach(item => {
                const key = groupKey(item);
                if (!grouped[key]) {
                    grouped[key] = {
                        date: item.date,
                        staff: item.staff,
                        customer: item.customer || '',
                        services: [],
                        total: 0,
                        ids: []
                    };
                }
                grouped[key].services.push(item.service);
                grouped[key].total += item.amount;
                grouped[key].ids.push(item.id);
            });
            Object.values(grouped).forEach(row => {
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDateTime(row.date)}</td>
                        <td>${row.staff}</td>
                        <td>${row.services.map(s => `<span class='service-badge'>${s}</span>`).join('')}</td>
                        <td>${row.customer}</td>
                        <td>${formatCurrency(row.total)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="alert('Ch·ª©c nƒÉng s·ª≠a ƒëang ph√°t tri·ªÉn')" type="button">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteGroupRevenue([${row.ids.map(id=>`'${id}'`).join(',')}])" type="button">X√≥a</button>
                        </td>
                    </tr>
                `;
            });
        }

        // H√†m x√≥a nh√≥m revenue
        function deleteGroupRevenue(ids) {
            let revenue = localStorage.getItem('salon_revenue');
            if (revenue) {
                try { revenue = JSON.parse(revenue); } catch { revenue = []; }
            } else { revenue = []; }
            revenue = revenue.filter(item => !ids.includes(String(item.id)));
            localStorage.setItem('salon_revenue', JSON.stringify(revenue));
            showToast('X√≥a th√†nh c√¥ng!');
            setTimeout(() => { renderRevenue(); updateStats(); updateChart(); }, 100);
        }

        function renderExpenses() {
            const tbody = document.querySelector('#expensesTable tbody');
            if (!tbody) return;
            let expenses = getData('salon_expenses', []);
            tbody.innerHTML = '';
            if (expenses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">Ch∆∞a c√≥ chi ph√≠ n√†o</td></tr>';
                return;
            }
            expenses.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.type}</td>
                        <td>${item.description}</td>
                        <td>${formatCurrency(item.amount)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="openModal('expenseModal', ${item.id})" type="button">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('expenses', ${item.id})" type="button">X√≥a</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Stats Functions
        function updateStats() {
            // L·∫•y d·ªØ li·ªáu revenue v√† bookings m·ªõi nh·∫•t t·ª´ localStorage
            let revenue = [];
            let bookings = [];
            try {
                const localRevenue = localStorage.getItem('salon_revenue');
                if (localRevenue) {
                    revenue = JSON.parse(localRevenue);
                } else {
                    revenue = salonData.revenue || [];
                }
            } catch { revenue = salonData.revenue || []; }
            try {
                const localBookings = localStorage.getItem('salon_bookings');
                if (localBookings) {
                    bookings = JSON.parse(localBookings);
                } else {
                    bookings = salonData.bookings || [];
                }
            } catch { bookings = salonData.bookings || []; }
            const today = new Date().toISOString().split('T')[0];
            // Today's revenue
            const todayRevenue = revenue
                .filter(item => item.date.split('T')[0] === today)
                .reduce((sum, item) => sum + item.amount, 0);
            const todayRevenueElement = document.getElementById('todayRevenue');
            if (todayRevenueElement) {
                todayRevenueElement.textContent = todayRevenue.toLocaleString('vi-VN');
            }
            // Today's appointments
            const todayRevenueAppointments = revenue
                .filter(item => item.date.split('T')[0] === today).length;
            const todayBookingAppointments = bookings
                .filter(item => item.date === today).length;
            const totalAppointments = todayRevenueAppointments + todayBookingAppointments;
            const todayAppointmentsElement = document.getElementById('todayAppointments');
            if (todayAppointmentsElement) {
                todayAppointmentsElement.textContent = totalAppointments;
            }
            // New customers this month
            const thisMonth = new Date().toISOString().slice(0, 7);
            const newCustomers = salonData.customers
                .filter(item => item.lastCut && item.lastCut.slice(0, 7) === thisMonth).length;
            const newCustomersElement = document.getElementById('newCustomers');
            if (newCustomersElement) {
                newCustomersElement.textContent = newCustomers;
            }
            // Online staff
            const onlineStaff = salonData.staff.filter(item => item.status === 'Online').length;
            const onlineStaffElement = document.getElementById('onlineStaff');
            if (onlineStaffElement) {
                onlineStaffElement.textContent = onlineStaff;
            }
        }

        function updateChart() {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;
            const context = ctx.getContext('2d');
            if (revenueChart) {
                revenueChart.destroy();
            }
            // L·∫•y d·ªØ li·ªáu revenue v√† expenses m·ªõi nh·∫•t t·ª´ localStorage
            let revenue = [];
            let expenses = [];
            try {
                const localRevenue = localStorage.getItem('salon_revenue');
                if (localRevenue) {
                    revenue = JSON.parse(localRevenue);
                } else {
                    revenue = salonData.revenue || [];
                }
            } catch { revenue = salonData.revenue || []; }
            try {
                const localExpenses = localStorage.getItem('salon_expenses');
                if (localExpenses) {
                    expenses = JSON.parse(localExpenses);
                } else {
                    expenses = salonData.expenses || [];
                }
            } catch { expenses = salonData.expenses || []; }
            const chartMonthElement = document.getElementById('chartMonth');
            const currentMonth = (chartMonthElement ? chartMonthElement.value : null) || new Date().toISOString().slice(0, 7);
            const daysInMonth = new Date(currentMonth.split('-')[0], currentMonth.split('-')[1], 0).getDate();
            const labels = [];
            const revenueData = [];
            const expenseData = [];
            for (let day = 1; day <= daysInMonth; day++) {
                const date = `${currentMonth}-${day.toString().padStart(2, '0')}`;
                labels.push(day);
                const dayRevenue = revenue
                    .filter(item => item.date.split('T')[0] === date)
                    .reduce((sum, item) => sum + item.amount, 0);
                revenueData.push(dayRevenue);
                const dayExpenses = expenses
                    .filter(item => item.date === date)
                    .reduce((sum, item) => sum + item.amount, 0);
                expenseData.push(dayExpenses);
            }
            try {
                revenueChart = new Chart(context, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Doanh thu',
                                data: revenueData,
                                borderColor: '#49958e',
                                backgroundColor: 'rgba(73, 149, 142, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Chi ph√≠',
                                data: expenseData,
                                borderColor: '#dc2626',
                                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrency(value);
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error creating chart:', error);
            }
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('vi-VN');
            const currentTimeElement = document.getElementById('currentTime');
            if (currentTimeElement) {
                currentTimeElement.textContent = timeString;
            }
        }

        // Notification Modal Logic
        function openModal(modalId, editId = null) {
            if (modalId === 'notificationModal') {
                const modal = document.getElementById('notificationModal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                if (editId) {
                    editingNotificationId = editId;
                    const noti = salonData.notifications.find(n => n.id === editId);
                    document.getElementById('notificationModalTitle').textContent = 'S·ª≠a th√¥ng b√°o';
                    document.getElementById('notificationTitle').value = noti ? noti.title : '';
                    document.getElementById('notificationContent').value = noti ? noti.content : '';
                } else {
                    editingNotificationId = null;
                    document.getElementById('notificationModalTitle').textContent = 'Th√™m th√¥ng b√°o';
                    document.getElementById('notificationTitle').value = '';
                    document.getElementById('notificationContent').value = '';
                }
            }
            if (modalId === 'staffModal') {
                const modal = document.getElementById('staffModal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                if (editId) {
                    editingStaffId = editId;
                    const staff = salonData.staff.find(s => s.id === editId);
                    document.getElementById('staffModalTitle').textContent = 'S·ª≠a nh√¢n vi√™n';
                    document.getElementById('staffName').value = staff ? staff.name : '';
                    document.getElementById('staffPhone').value = staff ? staff.phone : '';
                    const radios = document.querySelectorAll('input[name="staffPosition"]');
                    let pos = staff ? staff.position : 'Qu·∫£n l√Ω';
                    radios.forEach(r => { r.checked = (r.value === pos); });
                } else {
                    editingStaffId = null;
                    document.getElementById('staffModalTitle').textContent = 'Th√™m nh√¢n vi√™n';
                    document.getElementById('staffName').value = '';
                    document.getElementById('staffPhone').value = '';
                    const radios = document.querySelectorAll('input[name="staffPosition"]');
                    radios.forEach(r => { r.checked = false; });
                }
            }
            if (modalId === 'serviceModal') {
                const modal = document.getElementById('serviceModal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                if (editId) {
                    editingServiceId = editId;
                    const service = salonData.services.find(s => s.id === editId);
                    document.getElementById('serviceModalTitle').textContent = 'S·ª≠a d·ªãch v·ª•';
                    document.getElementById('serviceName').value = service ? service.name : '';
                    document.getElementById('servicePrice').value = service ? service.price : '';
                    document.getElementById('serviceDuration').value = service ? service.duration : '';
                    document.getElementById('serviceDescription').value = service ? service.description : '';
                } else {
                    editingServiceId = null;
                    document.getElementById('serviceModalTitle').textContent = 'Th√™m d·ªãch v·ª•';
                    document.getElementById('serviceName').value = '';
                    document.getElementById('servicePrice').value = '';
                    document.getElementById('serviceDuration').value = '';
                    document.getElementById('serviceDescription').value = '';
                }
            }
            if (modalId === 'expenseModal') {
                const modal = document.getElementById('expenseModal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                if (editId) {
                    editingExpenseId = editId;
                    const expense = salonData.expenses.find(e => e.id === editId);
                    document.getElementById('expenseModalTitle').textContent = 'S·ª≠a chi ph√≠';
                    document.getElementById('expenseDate').value = expense ? expense.date : '';
                    document.getElementById('expenseType').value = expense ? expense.type : '';
                    document.getElementById('expenseDescription').value = expense ? expense.description : '';
                    document.getElementById('expenseAmount').value = expense ? expense.amount : '';
                } else {
                    editingExpenseId = null;
                    document.getElementById('expenseModalTitle').textContent = 'Th√™m chi ph√≠';
                    document.getElementById('expenseDate').value = '';
                    document.getElementById('expenseType').value = '';
                    document.getElementById('expenseDescription').value = '';
                    document.getElementById('expenseAmount').value = '';
                }
            }
        }
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        document.getElementById('saveNotificationBtn').onclick = function() {
            const title = document.getElementById('notificationTitle').value.trim();
            const content = document.getElementById('notificationContent').value.trim();
            if (!title || !content) {
                showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Ti√™u ƒë·ªÅ v√† M√¥ t·∫£!', 'error');
                return;
            }
            if (editingNotificationId) {
                const noti = salonData.notifications.find(n => n.id === editingNotificationId);
                if (noti) {
                    noti.title = title;
                    noti.content = content;
                }
                showToast('C·∫≠p nh·∫≠t th√¥ng b√°o th√†nh c√¥ng!');
            } else {
                salonData.notifications.unshift({
                    id: generateId(salonData.notifications),
                    title,
                    content,
                    date: new Date().toISOString().slice(0,10)
                });
                showToast('Th√™m th√¥ng b√°o th√†nh c√¥ng!');
            }
            closeModal('notificationModal');
            renderNotifications();
        };
        document.getElementById('saveStaffBtn').onclick = function() {
            const name = document.getElementById('staffName').value.trim();
            const phone = document.getElementById('staffPhone').value.trim();
            const position = document.querySelector('input[name="staffPosition"]:checked').value;
            if (!name || !phone || !position) {
                showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }
            if (editingStaffId) {
                const staff = salonData.staff.find(s => s.id === editingStaffId);
                if (staff) {
                    staff.name = name;
                    staff.phone = phone;
                    staff.position = position;
                }
                showToast('C·∫≠p nh·∫≠t nh√¢n vi√™n th√†nh c√¥ng!');
            } else {
                salonData.staff.unshift({
                    id: generateId(salonData.staff),
                    name,
                    phone,
                    position
                });
                showToast('Th√™m nh√¢n vi√™n th√†nh c√¥ng!');
            }
            // ƒê·ªìng b·ªô sang localStorage
            localStorage.setItem('salon_staff', JSON.stringify(salonData.staff));
            closeModal('staffModal');
            renderStaff();
            updateStats();
        };
        document.getElementById('saveServiceBtn').onclick = function() {
            const name = document.getElementById('serviceName').value.trim();
            const price = parseInt(document.getElementById('servicePrice').value, 10);
            const duration = parseInt(document.getElementById('serviceDuration').value, 10);
            const description = document.getElementById('serviceDescription').value.trim();
            if (!name || isNaN(price) || isNaN(duration)) {
                showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n, gi√° v√† th·ªùi gian!', 'error');
                return;
            }
            if (editingServiceId) {
                // S·ª≠a
                const service = salonData.services.find(s => s.id === editingServiceId);
                if (service) {
                    service.name = name;
                    service.price = price;
                    service.duration = duration;
                    service.description = description;
                }
                showToast('C·∫≠p nh·∫≠t d·ªãch v·ª• th√†nh c√¥ng!');
            } else {
                // Th√™m m·ªõi
                salonData.services.unshift({
                    id: generateId(salonData.services),
                    name,
                    price,
                    duration,
                    description
                });
                showToast('Th√™m d·ªãch v·ª• th√†nh c√¥ng!');
            }
            // ƒê·ªìng b·ªô sang localStorage
            localStorage.setItem('salon_services', JSON.stringify(salonData.services));
            closeModal('serviceModal');
            renderServices();
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initNavigation();
            initMobileMenu();
            
            const chartMonth = document.getElementById('chartMonth');
            if (chartMonth) {
                chartMonth.value = new Date().toISOString().slice(0, 7);
                chartMonth.addEventListener('change', updateChart);
            }
            
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('custom-confirm')) {
                    closeConfirm(false);
                }
            });
            
            // Initial render
            setTimeout(() => {
                renderBookings();
                renderNotifications();
                renderStaff();
                renderServices();
                renderCustomers();
                renderRevenue();
                renderExpenses();
                updateStats();
                updateChart();
            }, 100);
            
            updateTime();
            setInterval(updateTime, 1000);
            
            // Th√™m s·ª± ki·ªán cho n√∫t L∆∞u chi ph√≠
            const saveExpenseBtn = document.getElementById('saveExpenseBtn');
            if (saveExpenseBtn) {
                saveExpenseBtn.onclick = function() {
                    const date = document.getElementById('expenseDate').value;
                    const type = document.getElementById('expenseType').value.trim();
                    const description = document.getElementById('expenseDescription').value.trim();
                    const amount = parseInt(document.getElementById('expenseAmount').value, 10);
                    if (!date || !type || isNaN(amount)) {
                        showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ng√†y, lo·∫°i chi ph√≠ v√† s·ªë ti·ªÅn!', 'error');
                        return;
                    }
                    // L·∫•y d·ªØ li·ªáu expenses m·ªõi nh·∫•t t·ª´ localStorage
                    let expenses = [];
                    try {
                        const localExpenses = localStorage.getItem('salon_expenses');
                        if (localExpenses) {
                            expenses = JSON.parse(localExpenses);
                        } else {
                            expenses = salonData.expenses || [];
                        }
                    } catch { expenses = salonData.expenses || []; }
                    if (editingExpenseId) {
                        // S·ª≠a
                        const expense = expenses.find(e => e.id === editingExpenseId);
                        if (expense) {
                            expense.date = date;
                            expense.type = type;
                            expense.description = description;
                            expense.amount = amount;
                        }
                        showToast('C·∫≠p nh·∫≠t chi ph√≠ th√†nh c√¥ng!');
                    } else {
                        // Th√™m m·ªõi
                        expenses.unshift({
                            id: Date.now() + Math.floor(Math.random()*100000),
                            date,
                            type,
                            description,
                            amount
                        });
                        showToast('Th√™m chi ph√≠ th√†nh c√¥ng!');
                    }
                    // ƒê·ªìng b·ªô l·∫°i localStorage v√† salonData
                    localStorage.setItem('salon_expenses', JSON.stringify(expenses));
                    salonData.expenses = expenses;
                    closeModal('expenseModal');
                    renderExpenses();
                    updateChart();
                };
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const openConfirm = document.querySelector('.custom-confirm.show');
                if (openConfirm) {
                    closeConfirm(false);
                }
            }
        });

        // Console
        console.log('üéâ Salon Management System loaded successfully!');
        console.log('‚úÖ All tables rendered with data');
        console.log('üî• Delete function working with custom confirm dialog');

        testLabel.addEventListener('click', function() {
            window.location.href = 'file:///C:/Users/pytho/Downloads/salon_management_system(1).html';
        });

        // T·ª± ƒë·ªông c·∫≠p nh·∫≠t bookings v√† revenue khi localStorage thay ƒë·ªïi ·ªü tab kh√°c
        window.addEventListener('storage', function(e) {
            if (e.key === 'salon_bookings') {
                try {
                    const newBookings = JSON.parse(localStorage.getItem('salon_bookings') || '[]');
                    salonData.bookings = newBookings;
                    renderBookings();
                    updateStats();
                } catch {}
            }
            if (e.key === 'salon_revenue') {
                try {
                    renderRevenue();
                    updateStats();
                    if (typeof updateChart === 'function') updateChart();
                } catch {}
            }
            if (e.key === 'salon_services') {
                try {
                    const newServices = JSON.parse(localStorage.getItem('salon_services') || '[]');
                    salonData.services = newServices;
                    renderServices();
                } catch {}
            }
        });

        // Khi load trang, kh·ªüi t·∫°o salonData t·ª´ localStorage n·∫øu c√≥
        function loadSalonData() {
            function getLS(key, fallback) {
                let data = localStorage.getItem(key);
                if (data) {
                    try { return JSON.parse(data); } catch { return fallback; }
                }
                return fallback;
            }
            salonData.bookings = getLS('salon_bookings', salonData.bookings);
            salonData.notifications = salonData.notifications; // notifications kh√¥ng ƒë·ªìng b·ªô qua localStorage
            salonData.staff = getLS('salon_staff', salonData.staff);
            salonData.services = getLS('salon_services', salonData.services);
            salonData.customers = getLS('salon_customers', salonData.customers);
            salonData.revenue = getLS('salon_revenue', salonData.revenue);
            salonData.expenses = getLS('salon_expenses', salonData.expenses);
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadSalonData();
            // ... existing code ...
        });

        function getData(key, fallback) {
            let data = localStorage.getItem(key);
            if (data) {
                try { return JSON.parse(data); } catch { return fallback; }
            }
            // N·∫øu ch∆∞a c√≥, l∆∞u fallback v√†o localStorage
            localStorage.setItem(key, JSON.stringify(fallback));
            return fallback;
        }
        function setData(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }
    </script>
    <script>
        function showLogin() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            var mainContent = document.getElementById('mainContent');
            if (mainContent) mainContent.style.display = 'none';
            var sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.style.display = 'none';
        }
        function hideLogin() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.body.style.overflow = '';
            var mainContent = document.getElementById('mainContent');
            if (mainContent) mainContent.style.display = '';
            var sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.style.display = '';
        }
        if (!localStorage.getItem('salon_admin_logged_in')) {
            showLogin();
        } else {
            hideLogin();
        }
        var loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.onsubmit = function(e) {
                e.preventDefault();
                var user = document.getElementById('adminUser').value.trim();
                var pass = document.getElementById('adminPass').value;
                if (user === 'admin' && pass === 'admin123') {
                    localStorage.setItem('salon_admin_logged_in', '1');
                    hideLogin();
                } else {
                    document.getElementById('loginError').style.display = 'block';
                }
            };
        }
        function logoutAdmin() {
            localStorage.removeItem('salon_admin_logged_in');
            showLogin();
        }
        </script>
</body>
</html>