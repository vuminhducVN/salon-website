<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống Quản lý Salon Tóc</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #49958e, #3a7a75);
            color: white;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-header .logo-icon {
            font-size: 24px;
        }

        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 600;
            color: white;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 15px;
            font-weight: 400;
            position: relative;
        }
        
        .nav-item:focus {
            outline: none;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
        }

        .nav-item.active {
            border-right: 3px solid white;
        }

        .nav-item .nav-icon {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-item .nav-icon svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 0;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .header {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h2 {
            color: #49958e;
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header h2 .page-icon {
            font-size: 24px;
        }

        .header h2 .page-icon svg {
            width: 24px;
            height: 24px;
            stroke: #49958e;
            fill: none;
            stroke-width: 2;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            display: none;
            background: #49958e;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            min-width: 44px;
            min-height: 44px;
            align-items: center;
            justify-content: center;
        }

        .menu-toggle:hover {
            background: #3a7a75;
        }

        .current-time {
            color: #666;
            font-size: 16px;
        }

        .content {
            padding: 30px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #49958e;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
            font-size: 16px;
        }

        /* Chart Container */
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            color: #49958e;
            font-size: 20px;
        }

        .date-picker {
            padding: 8px 12px;
            border: 2px solid #49958e;
            border-radius: 6px;
            font-size: 14px;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            color: #49958e;
            font-size: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #49958e;
            color: white;
        }

        .btn-primary:hover {
            background: #3a7a75;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #49958e;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-online {
            background: #dcfce7;
            color: #16a34a;
        }

        .status-offline {
            background: #fef3c7;
            color: #d97706;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* Custom Confirm Dialog */
        .custom-confirm {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .custom-confirm.show {
            display: flex !important;
        }

        .confirm-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .confirm-message {
            font-size: 16px;
            margin-bottom: 25px;
            color: #333;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-buttons .btn {
            min-width: 100px;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #16a34a;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            z-index: 3000;
            animation: slideInRight 0.3s ease;
        }

        .toast.error {
            background: #dc2626;
        }

        /* Animations */
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                max-width: 280px;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .menu-toggle {
                display: flex;
            }

            .header {
                padding: 15px 20px;
            }

            .header h2 {
                font-size: 20px;
            }

            .content {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .table-container {
                overflow-x: auto;
            }

            table {
                min-width: 600px;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Modal Styling */
        .custom-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.25);
            z-index: 4000;
            align-items: center;
            justify-content: center;
            animation: fadeInModal 0.2s;
        }
        .custom-modal.show {
            display: flex !important;
        }
        .modal-content {
            background: #fff;
            border-radius: 18px;
            padding: 32px 24px 20px 24px;
            min-width: 320px;
            max-width: 95vw;
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
            position: relative;
            animation: modalPop 0.25s;
        }
        .modal-content h3 {
            text-align: center;
            color: #49958e;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 18px;
        }
        .modal-content input,
        .modal-content textarea {
            width: 100%;
            padding: 11px 12px;
            border: 1.5px solid #c3cfe2;
            border-radius: 8px;
            font-size: 15px;
            margin-bottom: 13px;
            transition: border 0.2s;
            background: #f8f9fa;
            resize: none;
        }
        .modal-content input:focus,
        .modal-content textarea:focus {
            border: 1.5px solid #49958e;
            outline: none;
            background: #fff;
        }
        .modal-content .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 8px;
        }
        @media (max-width: 480px) {
            .modal-content {
                padding: 18px 7px 12px 7px;
                min-width: unset;
            }
            .modal-content h3 {
                font-size: 18px;
            }
        }
        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes modalPop {
            from { transform: scale(0.95); opacity: 0.7; }
            to { transform: scale(1); opacity: 1; }
        }
        .service-badge {
            display: inline-block;
            background: #f5f7fa;
            color: #49958e;
            border-radius: 999px;
            border: 1.2px solid #c3cfe2;
            padding: 2px 12px 2px 12px;
            font-size: 13px;
            font-weight: 600;
            margin: 0 4px 4px 0;
            line-height: 1.7;
            box-shadow: none;
            letter-spacing: 0.01em;
        }
        .role-radio-group {
            display: flex;
            justify-content: center;
            gap: 18px;
            background: #f8f9fa;
            border-radius: 18px;
            padding: 10px 0 6px 0;
            margin: 12px 0 18px 0;
        }
        .role-radio-group label {
            font-weight: 500;
            color: #49958e;
            padding: 4px 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .role-radio-group input[type=radio] {
            accent-color: #49958e;
            margin-right: 4px;
        }
    </style>
</head>
<body>
    <div id="loginOverlay" style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.15); align-items:center; justify-content:center;">
        <form id="loginForm" style="background:#fff; padding:32px 28px; border-radius:14px; box-shadow:0 8px 32px rgba(0,0,0,0.18); min-width:320px; max-width:95vw; display:flex; flex-direction:column; gap:18px;">
          <h2 style="color:#49958e; text-align:center;">Đăng nhập Admin</h2>
          <input id="adminUser" type="text" placeholder="Tài khoản" required autofocus>
          <input id="adminPass" type="password" placeholder="Mật khẩu" required>
          <button type="submit" class="btn btn-primary">Đăng nhập</button>
          <div id="loginError" style="color:#dc2626; text-align:center; display:none;">Sai tài khoản hoặc mật khẩu!</div>
        </form>
      </div>
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon">✂️</div>
                <h1>Salon Manager</h1>
            </div>
            <div class="nav-menu">
                <button class="nav-item active" data-section="overview">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9,22 9,12 15,12 15,22"></polyline>
                        </svg>
                    </div>
                    Tổng quan
                </button>
                <button class="nav-item" data-section="notifications">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="m13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                    </div>
                    Quản lý booking
                </button>
                <button class="nav-item" data-section="staff">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    Nhân viên
                </button>
                <button class="nav-item" data-section="services">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                        </svg>
                    </div>
                    Dịch vụ
                </button>
                <button class="nav-item" data-section="customers">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="m22 21-3-3"></path>
                            <path d="m22 18-3 3"></path>
                        </svg>
                    </div>
                    Khách hàng
                </button>
                <button class="nav-item" data-section="revenue">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </div>
                    Doanh thu
                </button>
                <button class="nav-item" data-section="expenses">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 20h9"></path>
                            <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"></path>
                        </svg>
                    </div>
                    Thu chi
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">☰</button>
                    <h2 id="pageTitle">
                        <div class="page-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9,22 9,12 15,12 15,22"></polyline>
                            </svg>
                        </div>
                        Tổng quan
                    </h2>
                </div>
                <div class="header-right">
                    <div class="current-time" id="currentTime"></div>
                    <button onclick="logoutAdmin()" class="btn btn-danger" style="margin-left:10px;">Đăng xuất</button>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Overview Section -->
                <section class="section active" id="overview">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3 id="todayRevenue">0</h3>
                            <p>Doanh thu hôm nay</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="todayAppointments">0</h3>
                            <p>Lịch hẹn hôm nay</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="newCustomers">0</h3>
                            <p>Khách hàng mới</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="onlineStaff">0</h3>
                            <p>Nhân viên online</p>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Biểu đồ doanh thu tháng</h3>
                            <input type="month" class="date-picker" id="chartMonth" />
                        </div>
                        <canvas id="revenueChart" height="100"></canvas>
                    </div>
                </section>

                <!-- Notifications Section -->
                <section class="section" id="notifications">
                    <!-- Danh sách Booking -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>📅 Danh sách Booking</h3>
                            <div style="color: #666; font-size: 14px;">Dữ liệu tự động từ trang booking</div>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="bookingsTable">
                                <thead>
                                    <tr>
                                        <th>Khách hàng</th>
                                        <th>Số điện thoại</th>
                                        <th>Dịch vụ</th>
                                        <th>Nhân viên</th>
                                        <th>Ngày</th>
                                        <th>Giờ</th>
                                        <th>Trạng thái</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Quản lý Thông báo -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>🔔 Quản lý Thông báo</h3>
                            <button class="btn btn-primary" onclick="openModal('notificationModal')">
                                + Thêm thông báo
                            </button>
                            <div style="color: #666; font-size: 14px; margin-top: 5px;">Thông báo hiển thị trên trang booking</div>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="notificationsTable">
                                <thead>
                                    <tr>
                                        <th>Ngày tạo</th>
                                        <th>Tiêu đề</th>
                                        <th>Nội dung</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Staff Section -->
                <section class="section" id="staff">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Quản lý Nhân viên</h3>
                            <button class="btn btn-primary" onclick="openModal('staffModal')">
                                + Thêm nhân viên
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="staffTable">
                                <thead>
                                    <tr>
                                        <th>Tên</th>
                                        <th>Chức vụ</th>
                                        <th>Số điện thoại</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Services Section -->
                <section class="section" id="services">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Quản lý Dịch vụ</h3>
                            <button class="btn btn-primary" onclick="openModal('serviceModal')">
                                + Thêm dịch vụ
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="servicesTable">
                                <thead>
                                    <tr>
                                        <th>Tên dịch vụ</th>
                                        <th>Giá (VNĐ)</th>
                                        <th>Thời gian (phút)</th>
                                        <th>Mô tả</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Customers Section -->
                <section class="section" id="customers">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Quản lý Khách hàng</h3>
                            <button class="btn btn-primary" onclick="openModal('customerModal')">
                                + Thêm khách hàng
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="customersTable">
                                <thead>
                                    <tr>
                                        <th>Tên khách hàng</th>
                                        <th>Số điện thoại</th>
                                        <th>Lần cắt cuối</th>
                                        <th>Loại đầu</th>
                                        <th>Ghi chú</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Revenue Section -->
                <section class="section" id="revenue">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Báo cáo Doanh thu</h3>
                            <button class="btn btn-primary" onclick="openModal('revenueModal')">
                                + Thêm giao dịch
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="revenueTable">
                                <thead>
                                    <tr>
                                        <th>Thời gian</th>
                                        <th>Nhân viên</th>
                                        <th>Dịch vụ</th>
                                        <th>Khách hàng</th>
                                        <th>Số tiền (VNĐ)</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Expenses Section -->
                <section class="section" id="expenses">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Quản lý Thu chi</h3>
                            <button class="btn btn-primary" onclick="openModal('expenseModal')">
                                + Thêm chi phí
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="expensesTable">
                                <thead>
                                    <tr>
                                        <th>Ngày</th>
                                        <th>Loại chi phí</th>
                                        <th>Mô tả</th>
                                        <th>Số tiền (VNĐ)</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Custom Confirm Dialog -->
    <div class="custom-confirm" id="customConfirm">
        <div class="confirm-content">
            <div class="confirm-message" id="confirmMessage">Bạn có chắc chắn muốn xóa không?</div>
            <div class="confirm-buttons">
                <button class="btn btn-secondary" onclick="closeConfirm(false)" type="button">Hủy</button>
                <button class="btn btn-danger" onclick="closeConfirm(true)" type="button">Xóa</button>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="custom-modal" id="notificationModal">
        <div class="modal-content">
            <h3 id="notificationModalTitle">Thêm thông báo</h3>
            <input id="notificationTitle" type="text" placeholder="Tiêu đề" />
            <textarea id="notificationContent" placeholder="Mô tả" rows="3"></textarea>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('notificationModal')" type="button">Hủy</button>
                <button class="btn btn-primary" id="saveNotificationBtn" type="button">Lưu</button>
            </div>
        </div>
    </div>

    <!-- Staff Modal -->
    <div class="custom-modal" id="staffModal">
        <div class="modal-content">
            <h3 id="staffModalTitle">Thêm nhân viên</h3>
            <input id="staffName" type="text" placeholder="Tên nhân viên" />
            <input id="staffPhone" type="text" placeholder="Số điện thoại" />
            <div id="staffPositionGroup" class="role-radio-group">
              <label><input type="radio" name="staffPosition" value="Quản lý"> Quản lý</label>
              <label><input type="radio" name="staffPosition" value="Thu ngân"> Thu ngân</label>
              <label><input type="radio" name="staffPosition" value="Barber"> Barber</label>
              <label><input type="radio" name="staffPosition" value="Skinner"> Skinner</label>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('staffModal')" type="button">Hủy</button>
                <button class="btn btn-primary" id="saveStaffBtn" type="button">Lưu</button>
            </div>
        </div>
    </div>

    <!-- Service Modal -->
    <div class="custom-modal" id="serviceModal">
        <div class="modal-content">
            <h3 id="serviceModalTitle">Thêm dịch vụ</h3>
            <input id="serviceName" type="text" placeholder="Tên dịch vụ" />
            <input id="servicePrice" type="number" placeholder="Giá (VNĐ)" />
            <input id="serviceDuration" type="number" placeholder="Thời gian (phút)" />
            <textarea id="serviceDescription" placeholder="Mô tả" rows="3"></textarea>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('serviceModal')" type="button">Hủy</button>
                <button class="btn btn-primary" id="saveServiceBtn" type="button">Lưu</button>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let salonData = {
            bookings: [
                { id: 1, customerName: "Nguyễn Văn A", phone: "0901234567", service: "Cắt tóc nam", staff: "Nguyễn Văn An", date: "2025-05-27", time: "09:00", status: "Đã xác nhận" },
                { id: 2, customerName: "Trần Thị B", phone: "0907654321", service: "Cắt tóc nữ", staff: "Trần Thị Bình", date: "2025-05-27", time: "10:30", status: "Chờ xác nhận" },
                { id: 3, customerName: "Lê Văn C", phone: "0912345678", service: "Nhuộm tóc", staff: "Nguyễn Văn An", date: "2025-05-28", time: "14:00", status: "Đã xác nhận" }
            ],
            notifications: [
                { id: 1, title: "Khuyến mãi tháng 5", content: "Giảm giá 20% cho khách hàng mới", date: "2025-05-01" },
                { id: 2, title: "Thông báo nghỉ lễ", content: "Salon nghỉ ngày 30/4 và 1/5", date: "2025-04-28" }
            ],
            staff: [
                { id: 1, name: "Nguyễn Văn An", position: "Thợ cắt tóc", phone: "0901234567" },
                { id: 2, name: "Trần Thị Bình", position: "Thợ gội đầu", phone: "0907654321" },
                { id: 3, name: "Lê Văn Cường", position: "Quản lý", phone: "0912345678" }
            ],
            services: [
                { id: 1, name: "Cắt tóc nam", price: 80000, duration: 30, description: "Cắt tóc nam cơ bản" },
                { id: 2, name: "Cắt tóc nữ", price: 120000, duration: 45, description: "Cắt tóc nữ cơ bản" },
                { id: 3, name: "Gội đầu massage", price: 50000, duration: 20, description: "Gội đầu và massage thư giãn" },
                { id: 4, name: "Nhuộm tóc", price: 300000, duration: 90, description: "Nhuộm tóc các màu" }
            ],
            customers: [
                { id: 1, name: "Phạm Văn Đức", phone: "0908888888", lastCut: "2025-05-27", hairType: "Tóc thẳng", notes: "Thích cắt ngắn" },
                { id: 2, name: "Nguyễn Thị Em", phone: "0909999999", lastCut: "2025-05-27", hairType: "Tóc xoăn", notes: "Cần tư vấn kiểu tóc" },
                { id: 3, name: "Lê Thành Phú", phone: "0907777777", lastCut: "2025-05-26", hairType: "Tóc thẳng", notes: "Khách hàng VIP" }
            ],
            revenue: [
                { id: 1, date: "2025-05-27T09:00", staff: "Nguyễn Văn An", service: "Cắt tóc nam", customer: "Phạm Văn Đức", amount: 80000 },
                { id: 2, date: "2025-05-27T10:30", staff: "Trần Thị Bình", service: "Gội đầu massage", customer: "Nguyễn Thị Em", amount: 50000 },
                { id: 3, date: "2025-05-27T14:15", staff: "Nguyễn Văn An", service: "Cắt tóc nữ", customer: "Lê Thành Phú", amount: 120000 },
                { id: 4, date: "2025-05-26T16:00", staff: "Trần Thị Bình", service: "Nhuộm tóc", customer: "Nguyễn Thị Em", amount: 300000 }
            ],
            expenses: [
                { id: 1, date: "2025-05-27", type: "Vật tư", description: "Mua kéo cắt tóc mới", amount: 500000 },
                { id: 2, date: "2025-05-26", type: "Điện nước", description: "Tiền điện tháng 5", amount: 800000 },
                { id: 3, date: "2025-05-25", type: "Lương nhân viên", description: "Lương tháng 5", amount: 15000000 }
            ]
        };

        let currentEditId = null;
        let revenueChart = null;
        let confirmCallback = null;
        let editingNotificationId = null;
        let editingStaffId = null;
        let editingServiceId = null;
        let editingExpenseId = null;

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { 
                style: 'currency', 
                currency: 'VND' 
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('vi-VN');
        }

        function formatDateTime(dateTimeString) {
            return new Date(dateTimeString).toLocaleString('vi-VN');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function generateId(array) {
            return array.length > 0 ? Math.max(...array.map(item => item.id)) + 1 : 1;
        }

        // Custom Confirm Dialog Functions
        function showCustomConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('customConfirm').classList.add('show');
            confirmCallback = callback;
            document.body.style.overflow = 'hidden';
        }

        function closeConfirm(confirmed) {
            document.getElementById('customConfirm').classList.remove('show');
            document.body.style.overflow = '';
            
            if (confirmCallback) {
                if (confirmed) {
                    confirmCallback();
                }
                confirmCallback = null;
            }
        }

        // Delete Function
        function deleteItem(type, id) {
            const confirmMessage = `Bạn có chắc chắn muốn xóa ${type === 'bookings' ? 'booking' : 
                                    type === 'notifications' ? 'thông báo' : 
                                    type === 'staff' ? 'nhân viên' : 
                                    type === 'services' ? 'dịch vụ' : 
                                    type === 'customers' ? 'khách hàng' : 
                                    type === 'revenue' ? 'giao dịch' : 'chi phí'} này không?`;
            showCustomConfirm(confirmMessage, () => {
                try {
                    if(type === 'revenue') {
                        // Xóa trong localStorage
                        let revenue = localStorage.getItem('salon_revenue');
                        if (revenue) {
                            try { revenue = JSON.parse(revenue); } catch { revenue = []; }
                        } else { revenue = []; }
                        const index = revenue.findIndex(item => item.id == id);
                        if (index > -1) {
                            revenue.splice(index, 1);
                            localStorage.setItem('salon_revenue', JSON.stringify(revenue));
                            showToast('Xóa thành công!');
                            setTimeout(() => { renderRevenue(); updateStats(); updateChart(); }, 100);
                        } else {
                            showToast('Không tìm thấy mục cần xóa!', 'error');
                        }
                        return;
                    }
                    // Xóa các loại khác như cũ
                    const index = salonData[type].findIndex(item => item.id == id);
                    if (index > -1) {
                        salonData[type].splice(index, 1);
                        // Nếu là dịch vụ thì đồng bộ lại localStorage
                        if(type === 'services') {
                            localStorage.setItem('salon_services', JSON.stringify(salonData.services));
                        }
                        // Nếu là nhân viên thì đồng bộ lại localStorage
                        if(type === 'staff') {
                            localStorage.setItem('salon_staff', JSON.stringify(salonData.staff));
                        }
                        showToast('Xóa thành công!');
                        setTimeout(() => {
                            switch(type) {
                                case 'bookings':
                                    renderBookings();
                                    updateStats();
                                    break;
                                case 'notifications':
                                    renderNotifications();
                                    break;
                                case 'staff':
                                    renderStaff();
                                    updateStats();
                                    break;
                                case 'services':
                                    renderServices();
                                    break;
                                case 'customers':
                                    renderCustomers();
                                    updateStats();
                                    break;
                                case 'revenue':
                                    renderRevenue();
                                    updateStats();
                                    updateChart();
                                    break;
                                case 'expenses':
                                    renderExpenses();
                                    updateChart();
                                    break;
                            }
                        }, 100);
                    } else {
                        showToast('Không tìm thấy mục cần xóa!', 'error');
                    }
                    // Trong hàm deleteItem, nếu type === 'customers' thì sau khi xóa cũng đồng bộ localStorage
                    if(type === 'customers') {
                        localStorage.setItem('salon_customers', JSON.stringify(salonData.customers));
                    }
                } catch (error) {
                    showToast('Có lỗi xảy ra khi xóa!', 'error');
                }
            });
        }

        function renderBookings() {
            const tbody = document.querySelector('#bookingsTable tbody');
            if (!tbody) return;
            let bookings = getData('salon_bookings', []);
            tbody.innerHTML = '';
            if (bookings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="no-data">Chưa có booking nào từ trang booking</td></tr>';
                return;
            }
            bookings.forEach(item => {
                if (!item.id) item.id = Date.now() + Math.floor(Math.random()*100000);
                if (!item.status) item.status = 'Chờ xác nhận';
                const statusClass = item.status === 'Đã xác nhận' ? 'status-online' : 'status-offline';
                tbody.innerHTML += `
                    <tr>
                        <td>${item.customerName || item.name || ''}</td>
                        <td>${item.phone || ''}</td>
                        <td>${item.service}</td>
                        <td>${item.staff}</td>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.time}</td>
                        <td><span class="status-badge ${statusClass}">${item.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-primary btn-sm" onclick="confirmBooking(${item.id})" type="button">
                                ${(item.status === 'Đã xác nhận') ? 'Hủy' : 'Xác nhận'}
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('bookings', ${item.id})" type="button">Xóa</button>
                        </td>
                    </tr>
                `;
            });
            setData('salon_bookings', bookings);
        }

        function confirmBooking(id) {
            let bookings = getData('salon_bookings', []);
            const booking = bookings.find(item => item.id == id);
            if (booking) {
                booking.status = booking.status === 'Đã xác nhận' ? 'Chờ xác nhận' : 'Đã xác nhận';
                setData('salon_bookings', bookings);
                renderBookings();
                updateStats();
                showToast(`Booking đã ${booking.status.toLowerCase()}!`);
            }
        }

        // Navigation
        function initNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.section');
            const pageTitle = document.getElementById('pageTitle');

            const sectionIcons = {
                'overview': '<svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9,22 9,12 15,12 15,22"></polyline></svg>',
                'notifications': '<svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="m13.73 21a2 2 0 0 1-3.46 0"></path></svg>',
                'staff': '<svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
                'services': '<svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>',
                'customers': '<svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="m22 21-3-3"></path><path d="m22 18-3 3"></path></svg>',
                'revenue': '<svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>',
                'expenses': '<svg viewBox="0 0 24 24"><path d="M12 20h9"></path><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"></path></svg>'
            };

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    sections.forEach(section => section.classList.remove('active'));
                    
                    const sectionId = item.dataset.section;
                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }
                    
                    const titleText = item.textContent.trim();
                    const iconSvg = sectionIcons[sectionId] || '';
                    pageTitle.innerHTML = `
                        <div class="page-icon">${iconSvg}</div>
                        ${titleText}
                    `;
                    
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.remove('show');
                    }
                });
            });
        }

        // Mobile Menu
        function initMobileMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            
            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                sidebar.classList.toggle('show');
            });
            
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768) {
                    if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                        sidebar.classList.remove('show');
                    }
                }
            });

            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('show');
                    }
                });
            });

            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    sidebar.classList.remove('show');
                }
            });
        }

        // Render Functions
        function renderNotifications() {
            const tbody = document.querySelector('#notificationsTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (salonData.notifications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="no-data">Chưa có thông báo nào</td></tr>';
                return;
            }
            
            salonData.notifications.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.title}</td>
                        <td>${item.content}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="openModal('notificationModal', ${item.id})" type="button">Sửa</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('notifications', ${item.id})" type="button">Xóa</button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderStaff() {
            const tbody = document.querySelector('#staffTable tbody');
            if (!tbody) return;
            const staff = getData('salon_staff', []);
            tbody.innerHTML = '';
            if (staff.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="no-data">Chưa có nhân viên nào</td></tr>';
                return;
            }
            staff.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.position}</td>
                        <td>${item.phone}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="openModal('staffModal', ${item.id})" type="button">Sửa</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('staff', ${item.id})" type="button">Xóa</button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderServices() {
            const tbody = document.querySelector('#servicesTable tbody');
            if (!tbody) return;
            const services = getData('salon_services', []);
            tbody.innerHTML = '';
            if (services.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">Chưa có dịch vụ nào</td></tr>';
                return;
            }
            services.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${formatCurrency(item.price)}</td>
                        <td>${item.duration}</td>
                        <td>${item.description || ''}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="openModal('serviceModal', ${item.id})" type="button">Sửa</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('services', ${item.id})" type="button">Xóa</button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderCustomers() {
            const tbody = document.querySelector('#customersTable tbody');
            if (!tbody) return;
            const customers = getData('salon_customers', []);
            tbody.innerHTML = '';
            if (customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">Chưa có khách hàng nào</td></tr>';
                return;
            }
            customers.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.phone}</td>
                        <td>${item.lastCut ? formatDate(item.lastCut) : ''}</td>
                        <td>${item.hairType || ''}</td>
                        <td>${item.notes || ''}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="alert('Chức năng sửa đang phát triển')" type="button">Sửa</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('customers', ${item.id})" type="button">Xóa</button>
                        </td>
                    </tr>
                `;
            });
        }

        function renderRevenue() {
            const tbody = document.querySelector('#revenueTable tbody');
            if (!tbody) return;
            let revenue = getData('salon_revenue', []);
            tbody.innerHTML = '';
            if (revenue.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">Chưa có giao dịch nào</td></tr>';
                return;
            }
            const groupKey = item => `${item.date}|${item.staff}|${item.customer || ''}`;
            const grouped = {};
            revenue.forEach(item => {
                const key = groupKey(item);
                if (!grouped[key]) {
                    grouped[key] = {
                        date: item.date,
                        staff: item.staff,
                        customer: item.customer || '',
                        services: [],
                        total: 0,
                        ids: []
                    };
                }
                grouped[key].services.push(item.service);
                grouped[key].total += item.amount;
                grouped[key].ids.push(item.id);
            });
            Object.values(grouped).forEach(row => {
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDateTime(row.date)}</td>
                        <td>${row.staff}</td>
                        <td>${row.services.map(s => `<span class='service-badge'>${s}</span>`).join('')}</td>
                        <td>${row.customer}</td>
                        <td>${formatCurrency(row.total)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="alert('Chức năng sửa đang phát triển')" type="button">Sửa</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteGroupRevenue([${row.ids.map(id=>`'${id}'`).join(',')}])" type="button">Xóa</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Hàm xóa nhóm revenue
        function deleteGroupRevenue(ids) {
            let revenue = localStorage.getItem('salon_revenue');
            if (revenue) {
                try { revenue = JSON.parse(revenue); } catch { revenue = []; }
            } else { revenue = []; }
            revenue = revenue.filter(item => !ids.includes(String(item.id)));
            localStorage.setItem('salon_revenue', JSON.stringify(revenue));
            showToast('Xóa thành công!');
            setTimeout(() => { renderRevenue(); updateStats(); updateChart(); }, 100);
        }

        function renderExpenses() {
            const tbody = document.querySelector('#expensesTable tbody');
            if (!tbody) return;
            let expenses = getData('salon_expenses', []);
            tbody.innerHTML = '';
            if (expenses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">Chưa có chi phí nào</td></tr>';
                return;
            }
            expenses.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDate(item.date)}</td>
                        <td>${item.type}</td>
                        <td>${item.description}</td>
                        <td>${formatCurrency(item.amount)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="openModal('expenseModal', ${item.id})" type="button">Sửa</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('expenses', ${item.id})" type="button">Xóa</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Stats Functions
        function updateStats() {
            // Lấy dữ liệu revenue và bookings mới nhất từ localStorage
            let revenue = [];
            let bookings = [];
            try {
                const localRevenue = localStorage.getItem('salon_revenue');
                if (localRevenue) {
                    revenue = JSON.parse(localRevenue);
                } else {
                    revenue = salonData.revenue || [];
                }
            } catch { revenue = salonData.revenue || []; }
            try {
                const localBookings = localStorage.getItem('salon_bookings');
                if (localBookings) {
                    bookings = JSON.parse(localBookings);
                } else {
                    bookings = salonData.bookings || [];
                }
            } catch { bookings = salonData.bookings || []; }
            const today = new Date().toISOString().split('T')[0];
            // Today's revenue
            const todayRevenue = revenue
                .filter(item => item.date.split('T')[0] === today)
                .reduce((sum, item) => sum + item.amount, 0);
            const todayRevenueElement = document.getElementById('todayRevenue');
            if (todayRevenueElement) {
                todayRevenueElement.textContent = todayRevenue.toLocaleString('vi-VN');
            }
            // Today's appointments
            const todayRevenueAppointments = revenue
                .filter(item => item.date.split('T')[0] === today).length;
            const todayBookingAppointments = bookings
                .filter(item => item.date === today).length;
            const totalAppointments = todayRevenueAppointments + todayBookingAppointments;
            const todayAppointmentsElement = document.getElementById('todayAppointments');
            if (todayAppointmentsElement) {
                todayAppointmentsElement.textContent = totalAppointments;
            }
            // New customers this month
            const thisMonth = new Date().toISOString().slice(0, 7);
            const newCustomers = salonData.customers
                .filter(item => item.lastCut && item.lastCut.slice(0, 7) === thisMonth).length;
            const newCustomersElement = document.getElementById('newCustomers');
            if (newCustomersElement) {
                newCustomersElement.textContent = newCustomers;
            }
            // Online staff
            const onlineStaff = salonData.staff.filter(item => item.status === 'Online').length;
            const onlineStaffElement = document.getElementById('onlineStaff');
            if (onlineStaffElement) {
                onlineStaffElement.textContent = onlineStaff;
            }
        }

        function updateChart() {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;
            const context = ctx.getContext('2d');
            if (revenueChart) {
                revenueChart.destroy();
            }
            // Lấy dữ liệu revenue và expenses mới nhất từ localStorage
            let revenue = [];
            let expenses = [];
            try {
                const localRevenue = localStorage.getItem('salon_revenue');
                if (localRevenue) {
                    revenue = JSON.parse(localRevenue);
                } else {
                    revenue = salonData.revenue || [];
                }
            } catch { revenue = salonData.revenue || []; }
            try {
                const localExpenses = localStorage.getItem('salon_expenses');
                if (localExpenses) {
                    expenses = JSON.parse(localExpenses);
                } else {
                    expenses = salonData.expenses || [];
                }
            } catch { expenses = salonData.expenses || []; }
            const chartMonthElement = document.getElementById('chartMonth');
            const currentMonth = (chartMonthElement ? chartMonthElement.value : null) || new Date().toISOString().slice(0, 7);
            const daysInMonth = new Date(currentMonth.split('-')[0], currentMonth.split('-')[1], 0).getDate();
            const labels = [];
            const revenueData = [];
            const expenseData = [];
            for (let day = 1; day <= daysInMonth; day++) {
                const date = `${currentMonth}-${day.toString().padStart(2, '0')}`;
                labels.push(day);
                const dayRevenue = revenue
                    .filter(item => item.date.split('T')[0] === date)
                    .reduce((sum, item) => sum + item.amount, 0);
                revenueData.push(dayRevenue);
                const dayExpenses = expenses
                    .filter(item => item.date === date)
                    .reduce((sum, item) => sum + item.amount, 0);
                expenseData.push(dayExpenses);
            }
            try {
                revenueChart = new Chart(context, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Doanh thu',
                                data: revenueData,
                                borderColor: '#49958e',
                                backgroundColor: 'rgba(73, 149, 142, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Chi phí',
                                data: expenseData,
                                borderColor: '#dc2626',
                                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrency(value);
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error creating chart:', error);
            }
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('vi-VN');
            const currentTimeElement = document.getElementById('currentTime');
            if (currentTimeElement) {
                currentTimeElement.textContent = timeString;
            }
        }

        // Notification Modal Logic
        function openModal(modalId, editId = null) {
            if (modalId === 'notificationModal') {
                const modal = document.getElementById('notificationModal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                if (editId) {
                    editingNotificationId = editId;
                    const noti = salonData.notifications.find(n => n.id === editId);
                    document.getElementById('notificationModalTitle').textContent = 'Sửa thông báo';
                    document.getElementById('notificationTitle').value = noti ? noti.title : '';
                    document.getElementById('notificationContent').value = noti ? noti.content : '';
                } else {
                    editingNotificationId = null;
                    document.getElementById('notificationModalTitle').textContent = 'Thêm thông báo';
                    document.getElementById('notificationTitle').value = '';
                    document.getElementById('notificationContent').value = '';
                }
            }
            if (modalId === 'staffModal') {
                const modal = document.getElementById('staffModal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                if (editId) {
                    editingStaffId = editId;
                    const staff = salonData.staff.find(s => s.id === editId);
                    document.getElementById('staffModalTitle').textContent = 'Sửa nhân viên';
                    document.getElementById('staffName').value = staff ? staff.name : '';
                    document.getElementById('staffPhone').value = staff ? staff.phone : '';
                    const radios = document.querySelectorAll('input[name="staffPosition"]');
                    let pos = staff ? staff.position : 'Quản lý';
                    radios.forEach(r => { r.checked = (r.value === pos); });
                } else {
                    editingStaffId = null;
                    document.getElementById('staffModalTitle').textContent = 'Thêm nhân viên';
                    document.getElementById('staffName').value = '';
                    document.getElementById('staffPhone').value = '';
                    const radios = document.querySelectorAll('input[name="staffPosition"]');
                    radios.forEach(r => { r.checked = false; });
                }
            }
            if (modalId === 'serviceModal') {
                const modal = document.getElementById('serviceModal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                if (editId) {
                    editingServiceId = editId;
                    const service = salonData.services.find(s => s.id === editId);
                    document.getElementById('serviceModalTitle').textContent = 'Sửa dịch vụ';
                    document.getElementById('serviceName').value = service ? service.name : '';
                    document.getElementById('servicePrice').value = service ? service.price : '';
                    document.getElementById('serviceDuration').value = service ? service.duration : '';
                    document.getElementById('serviceDescription').value = service ? service.description : '';
                } else {
                    editingServiceId = null;
                    document.getElementById('serviceModalTitle').textContent = 'Thêm dịch vụ';
                    document.getElementById('serviceName').value = '';
                    document.getElementById('servicePrice').value = '';
                    document.getElementById('serviceDuration').value = '';
                    document.getElementById('serviceDescription').value = '';
                }
            }
            if (modalId === 'expenseModal') {
                const modal = document.getElementById('expenseModal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                if (editId) {
                    editingExpenseId = editId;
                    const expense = salonData.expenses.find(e => e.id === editId);
                    document.getElementById('expenseModalTitle').textContent = 'Sửa chi phí';
                    document.getElementById('expenseDate').value = expense ? expense.date : '';
                    document.getElementById('expenseType').value = expense ? expense.type : '';
                    document.getElementById('expenseDescription').value = expense ? expense.description : '';
                    document.getElementById('expenseAmount').value = expense ? expense.amount : '';
                } else {
                    editingExpenseId = null;
                    document.getElementById('expenseModalTitle').textContent = 'Thêm chi phí';
                    document.getElementById('expenseDate').value = '';
                    document.getElementById('expenseType').value = '';
                    document.getElementById('expenseDescription').value = '';
                    document.getElementById('expenseAmount').value = '';
                }
            }
        }
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        document.getElementById('saveNotificationBtn').onclick = function() {
            const title = document.getElementById('notificationTitle').value.trim();
            const content = document.getElementById('notificationContent').value.trim();
            if (!title || !content) {
                showToast('Vui lòng nhập đầy đủ Tiêu đề và Mô tả!', 'error');
                return;
            }
            if (editingNotificationId) {
                const noti = salonData.notifications.find(n => n.id === editingNotificationId);
                if (noti) {
                    noti.title = title;
                    noti.content = content;
                }
                showToast('Cập nhật thông báo thành công!');
            } else {
                salonData.notifications.unshift({
                    id: generateId(salonData.notifications),
                    title,
                    content,
                    date: new Date().toISOString().slice(0,10)
                });
                showToast('Thêm thông báo thành công!');
            }
            closeModal('notificationModal');
            renderNotifications();
        };
        document.getElementById('saveStaffBtn').onclick = function() {
            const name = document.getElementById('staffName').value.trim();
            const phone = document.getElementById('staffPhone').value.trim();
            const position = document.querySelector('input[name="staffPosition"]:checked').value;
            if (!name || !phone || !position) {
                showToast('Vui lòng nhập đầy đủ thông tin!', 'error');
                return;
            }
            if (editingStaffId) {
                const staff = salonData.staff.find(s => s.id === editingStaffId);
                if (staff) {
                    staff.name = name;
                    staff.phone = phone;
                    staff.position = position;
                }
                showToast('Cập nhật nhân viên thành công!');
            } else {
                salonData.staff.unshift({
                    id: generateId(salonData.staff),
                    name,
                    phone,
                    position
                });
                showToast('Thêm nhân viên thành công!');
            }
            // Đồng bộ sang localStorage
            localStorage.setItem('salon_staff', JSON.stringify(salonData.staff));
            closeModal('staffModal');
            renderStaff();
            updateStats();
        };
        document.getElementById('saveServiceBtn').onclick = function() {
            const name = document.getElementById('serviceName').value.trim();
            const price = parseInt(document.getElementById('servicePrice').value, 10);
            const duration = parseInt(document.getElementById('serviceDuration').value, 10);
            const description = document.getElementById('serviceDescription').value.trim();
            if (!name || isNaN(price) || isNaN(duration)) {
                showToast('Vui lòng nhập đầy đủ tên, giá và thời gian!', 'error');
                return;
            }
            if (editingServiceId) {
                // Sửa
                const service = salonData.services.find(s => s.id === editingServiceId);
                if (service) {
                    service.name = name;
                    service.price = price;
                    service.duration = duration;
                    service.description = description;
                }
                showToast('Cập nhật dịch vụ thành công!');
            } else {
                // Thêm mới
                salonData.services.unshift({
                    id: generateId(salonData.services),
                    name,
                    price,
                    duration,
                    description
                });
                showToast('Thêm dịch vụ thành công!');
            }
            // Đồng bộ sang localStorage
            localStorage.setItem('salon_services', JSON.stringify(salonData.services));
            closeModal('serviceModal');
            renderServices();
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initNavigation();
            initMobileMenu();
            
            const chartMonth = document.getElementById('chartMonth');
            if (chartMonth) {
                chartMonth.value = new Date().toISOString().slice(0, 7);
                chartMonth.addEventListener('change', updateChart);
            }
            
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('custom-confirm')) {
                    closeConfirm(false);
                }
            });
            
            // Initial render
            setTimeout(() => {
                renderBookings();
                renderNotifications();
                renderStaff();
                renderServices();
                renderCustomers();
                renderRevenue();
                renderExpenses();
                updateStats();
                updateChart();
            }, 100);
            
            updateTime();
            setInterval(updateTime, 1000);
            
            // Thêm sự kiện cho nút Lưu chi phí
            const saveExpenseBtn = document.getElementById('saveExpenseBtn');
            if (saveExpenseBtn) {
                saveExpenseBtn.onclick = function() {
                    const date = document.getElementById('expenseDate').value;
                    const type = document.getElementById('expenseType').value.trim();
                    const description = document.getElementById('expenseDescription').value.trim();
                    const amount = parseInt(document.getElementById('expenseAmount').value, 10);
                    if (!date || !type || isNaN(amount)) {
                        showToast('Vui lòng nhập đầy đủ ngày, loại chi phí và số tiền!', 'error');
                        return;
                    }
                    // Lấy dữ liệu expenses mới nhất từ localStorage
                    let expenses = [];
                    try {
                        const localExpenses = localStorage.getItem('salon_expenses');
                        if (localExpenses) {
                            expenses = JSON.parse(localExpenses);
                        } else {
                            expenses = salonData.expenses || [];
                        }
                    } catch { expenses = salonData.expenses || []; }
                    if (editingExpenseId) {
                        // Sửa
                        const expense = expenses.find(e => e.id === editingExpenseId);
                        if (expense) {
                            expense.date = date;
                            expense.type = type;
                            expense.description = description;
                            expense.amount = amount;
                        }
                        showToast('Cập nhật chi phí thành công!');
                    } else {
                        // Thêm mới
                        expenses.unshift({
                            id: Date.now() + Math.floor(Math.random()*100000),
                            date,
                            type,
                            description,
                            amount
                        });
                        showToast('Thêm chi phí thành công!');
                    }
                    // Đồng bộ lại localStorage và salonData
                    localStorage.setItem('salon_expenses', JSON.stringify(expenses));
                    salonData.expenses = expenses;
                    closeModal('expenseModal');
                    renderExpenses();
                    updateChart();
                };
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const openConfirm = document.querySelector('.custom-confirm.show');
                if (openConfirm) {
                    closeConfirm(false);
                }
            }
        });

        // Console
        console.log('🎉 Salon Management System loaded successfully!');
        console.log('✅ All tables rendered with data');
        console.log('🔥 Delete function working with custom confirm dialog');

        testLabel.addEventListener('click', function() {
            window.location.href = 'file:///C:/Users/pytho/Downloads/salon_management_system(1).html';
        });

        // Tự động cập nhật bookings và revenue khi localStorage thay đổi ở tab khác
        window.addEventListener('storage', function(e) {
            if (e.key === 'salon_bookings') {
                try {
                    const newBookings = JSON.parse(localStorage.getItem('salon_bookings') || '[]');
                    salonData.bookings = newBookings;
                    renderBookings();
                    updateStats();
                } catch {}
            }
            if (e.key === 'salon_revenue') {
                try {
                    renderRevenue();
                    updateStats();
                    if (typeof updateChart === 'function') updateChart();
                } catch {}
            }
            if (e.key === 'salon_services') {
                try {
                    const newServices = JSON.parse(localStorage.getItem('salon_services') || '[]');
                    salonData.services = newServices;
                    renderServices();
                } catch {}
            }
        });

        // Khi load trang, khởi tạo salonData từ localStorage nếu có
        function loadSalonData() {
            function getLS(key, fallback) {
                let data = localStorage.getItem(key);
                if (data) {
                    try { return JSON.parse(data); } catch { return fallback; }
                }
                return fallback;
            }
            salonData.bookings = getLS('salon_bookings', salonData.bookings);
            salonData.notifications = salonData.notifications; // notifications không đồng bộ qua localStorage
            salonData.staff = getLS('salon_staff', salonData.staff);
            salonData.services = getLS('salon_services', salonData.services);
            salonData.customers = getLS('salon_customers', salonData.customers);
            salonData.revenue = getLS('salon_revenue', salonData.revenue);
            salonData.expenses = getLS('salon_expenses', salonData.expenses);
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadSalonData();
            // ... existing code ...
        });

        function getData(key, fallback) {
            let data = localStorage.getItem(key);
            if (data) {
                try { return JSON.parse(data); } catch { return fallback; }
            }
            // Nếu chưa có, lưu fallback vào localStorage
            localStorage.setItem(key, JSON.stringify(fallback));
            return fallback;
        }
        function setData(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }
    </script>
    <script>
        function showLogin() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            var mainContent = document.getElementById('mainContent');
            if (mainContent) mainContent.style.display = 'none';
            var sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.style.display = 'none';
        }
        function hideLogin() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.body.style.overflow = '';
            var mainContent = document.getElementById('mainContent');
            if (mainContent) mainContent.style.display = '';
            var sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.style.display = '';
        }
        if (!localStorage.getItem('salon_admin_logged_in')) {
            showLogin();
        } else {
            hideLogin();
        }
        var loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.onsubmit = function(e) {
                e.preventDefault();
                var user = document.getElementById('adminUser').value.trim();
                var pass = document.getElementById('adminPass').value;
                if (user === 'admin' && pass === 'admin123') {
                    localStorage.setItem('salon_admin_logged_in', '1');
                    hideLogin();
                } else {
                    document.getElementById('loginError').style.display = 'block';
                }
            };
        }
        function logoutAdmin() {
            localStorage.removeItem('salon_admin_logged_in');
            showLogin();
        }
        </script>
</body>
</html>