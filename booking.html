<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt lịch Salon</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        .booking-container {
            max-width: 900px;
            margin: 40px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.10);
            display: flex;
            overflow: hidden;
        }
        .services-list {
            flex: 1.1;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 36px 28px 36px 36px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            min-width: 260px;
        }
        .service-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.07);
            padding: 18px 20px;
            margin-bottom: 0;
        }
        .service-title {
            font-size: 18px;
            font-weight: 600;
            color: #49958e;
            margin-bottom: 6px;
        }
        .service-price {
            color: #dc2626;
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }
        .service-desc {
            font-size: 14px;
            color: #555;
            opacity: 0.9;
        }
        .booking-form {
            flex: 1.2;
            padding: 36px 36px 36px 28px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .form-title {
            font-size: 22px;
            font-weight: 700;
            color: #3a7a75;
            margin-bottom: 18px;
            text-align: center;
        }
        .form-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            color: #49958e;
            font-weight: 500;
        }
        input, select, textarea {
            width: 100%;
            padding: 11px 12px;
            border: 1.5px solid #c3cfe2;
            border-radius: 8px;
            font-size: 15px;
            margin-bottom: 2px;
            transition: border 0.2s;
            background: #f8f9fa;
        }
        input:focus, select:focus, textarea:focus {
            border: 1.5px solid #49958e;
            outline: none;
            background: #fff;
        }
        .btn-book {
            background: linear-gradient(90deg, #49958e, #3a7a75);
            color: #fff;
            border: none;
            padding: 12px 0;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.2s;
        }
        .btn-book:hover {
            background: linear-gradient(90deg, #3a7a75, #49958e);
        }
        .success-message {
            color: #16a34a;
            text-align: center;
            font-size: 16px;
            margin-top: 18px;
        }
        @media (max-width: 900px) {
            .booking-container {
                flex-direction: column;
                max-width: 98vw;
            }
            .services-list, .booking-form {
                padding: 22px 12px;
            }
        }
        @media (max-width: 600px) {
            .booking-container {
                margin: 10px 0;
            }
            .form-title {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="booking-container">
        <div class="services-list">
            <div class="service-card">
                <div class="service-title">Cắt tóc & xả</div>
                <div class="service-price">50.000đ</div>
                <div class="service-desc">Cắt tóc, gội xả sạch sẽ, tạo kiểu đơn giản.</div>
            </div>
            <div class="service-card">
                <div class="service-title">Combo 1</div>
                <div class="service-price">140.000đ</div>
                <div class="service-desc">Tư vấn, cắt tóc theo khuôn mặt. Cạo mặt, ráy tai. Gội đầu thư giãn. Tẩy tế bào chết, rửa mặt. Sấy tạo kiểu.</div>
            </div>
            <div class="service-card">
                <div class="service-title">Combo 2</div>
                <div class="service-price">200.000đ</div>
                <div class="service-desc">Tư vấn, cắt tóc theo khuôn mặt. Cạo mặt, ráy tai. Lột mụn. Tẩy tế bào chết, rửa mặt, đắp mặt nạ. Massage mặt, gội đầu chuẩn. Xông hơi hút mụn. Massage vai-cổ-gáy. Vuốt sáp tạo kiểu.</div>
            </div>
            <div class="service-card">
                <div class="service-title">Cạo mặt, ráy tai, gội đầu</div>
                <div class="service-desc">Chăm sóc da mặt, ráy tai, gội đầu thư giãn chuyên nghiệp.</div>
            </div>
            <div class="service-card">
                <div class="service-title">Dịch vụ hóa chất (nhuộm/uốn,...)</div>
                <div class="service-desc">Nhuộm, uốn, phục hồi, tạo kiểu hóa chất chuyên sâu.</div>
            </div>
        </div>
        <form class="booking-form" id="bookingForm">
            <div class="form-title">Đặt lịch hẹn</div>
            <div class="form-group">
                <label for="date">Ngày</label>
                <input type="date" id="date" name="date" required min="{{today}}">
            </div>
            <div class="form-group">
                <label for="time">Giờ</label>
                <input type="time" id="time" name="time" required>
            </div>
            <div class="form-group">
                <label for="name">Tên khách hàng</label>
                <input type="text" id="name" name="name" required maxlength="50">
            </div>
            <div class="form-group">
                <label for="phone">Số điện thoại</label>
                <input type="text" id="phone" name="phone" maxlength="20">
            </div>
            <div class="form-group">
                <label for="service">Chọn dịch vụ</label>
                <select id="service" name="service" required>
                    <option value="Cắt tóc & xả">Cắt tóc & xả (50.000đ)</option>
                    <option value="Combo 1">Combo 1 (140.000đ)</option>
                    <option value="Combo 2">Combo 2 (200.000đ)</option>
                    <option value="Cạo mặt, ráy tai, gội đầu">Cạo mặt, ráy tai, gội đầu</option>
                    <option value="Dịch vụ hóa chất">Dịch vụ hóa chất</option>
                </select>
            </div>
            <div class="form-group">
                <label for="staff">Chọn thợ thực hiện</label>
                <select id="staff" name="staff" required>
                    <option value="">Đang tải thợ...</option>
                </select>
            </div>
            <button class="btn-book" type="submit">Đặt lịch ngay</button>
            <div class="success-message" id="successMsg" style="display:none"></div>
        </form>
    </div>
    <script>
        // Lấy danh sách thợ từ localStorage (giả lập lấy từ salon_management)
        // Ở bản thực tế sẽ fetch từ backend hoặc window.parent nếu cùng domain
        function getStaffList() {
            let staff = localStorage.getItem('salon_staff');
            if (staff) {
                try { staff = JSON.parse(staff); } catch { staff = []; }
            } else {
                staff = [
                    { name: "Nguyễn Văn An", position: "Barber" },
                    { name: "Trần Thị Bình", position: "Skinner" },
                    { name: "Lê Văn Cường", position: "Barber" }
                ];
            }
            return staff;
        }
        // Thêm hàm lọc thợ theo dịch vụ:
        function filterStaffByService(service) {
            const staffList = getStaffList();
            if (service === 'Cạo mặt, ráy tai, gội đầu') {
                return staffList.filter(s => s.position === 'Skinner');
            } else if (service === 'Dịch vụ hóa chất') {
                return staffList.filter(s => s.position === 'Barber');
            } else {
                return staffList.filter(s => s.position === 'Barber');
            }
        }
        // Sửa renderStaffOptions để nhận service:
        function renderStaffOptions(service) {
            const staffList = filterStaffByService(service || document.getElementById('service').value);
            const select = document.getElementById('staff');
            select.innerHTML = '<option value="">-- Chọn thợ --</option>' +
                staffList.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
        }
        // Gọi lại renderStaffOptions khi chọn dịch vụ:
        document.getElementById('service').addEventListener('change', function() {
            renderStaffOptions(this.value);
        });
        // Gọi lần đầu:
        renderStaffOptions();
        // Set min date cho input date là hôm nay
        document.getElementById('date').min = new Date().toISOString().split('T')[0];
        // Xử lý submit form
        document.getElementById('bookingForm').onsubmit = function(e) {
            e.preventDefault();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const service = document.getElementById('service').value;
            const staff = document.getElementById('staff').value;
            if (!date || !time || !name || !service || !staff) {
                alert('Vui lòng nhập đầy đủ thông tin bắt buộc!');
                return;
            }
            // Gửi dữ liệu booking sang localStorage (giả lập gửi sang backend)
            let bookings = localStorage.getItem('salon_bookings');
            if (bookings) {
                try { bookings = JSON.parse(bookings); } catch { bookings = []; }
            } else {
                bookings = [];
            }
            bookings.push({
                id: Date.now() + Math.floor(Math.random()*100000),
                date, time, name, phone, service, staff,
                status: 'Chờ xác nhận',
                created: new Date().toISOString()
            });
            localStorage.setItem('salon_bookings', JSON.stringify(bookings));
            // Thêm khách mới nếu chưa có (bảo mật: không xuất ngược danh sách khách)
            let customers = localStorage.getItem('salon_customers');
            if (customers) {
                try { customers = JSON.parse(customers); } catch { customers = []; }
            } else {
                customers = [];
            }
            if (phone && !customers.some(c => c.phone === phone)) {
                customers.push({ name, phone, lastCut: date });
                localStorage.setItem('salon_customers', JSON.stringify(customers));
            }
            document.getElementById('successMsg').style.display = 'block';
            document.getElementById('successMsg').textContent = 'Đặt lịch thành công! Cảm ơn bạn đã tin tưởng Salon.';
            this.reset();
            setTimeout(() => {
                document.getElementById('successMsg').style.display = 'none';
            }, 3500);
        };
    </script>
</body>
</html>
